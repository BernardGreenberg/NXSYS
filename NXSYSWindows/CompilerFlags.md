# NXSYS Compiler Flags
##### 26 February 2022

The NXSYS sources are ridden with C++ Preprocessor conditionalizations.  Many are obsolete.  I'm trying to extirpate the latter, but that is a tedious and unrewarding, hence low-priority task, as each such step requires lengthy (on Windows) rebuilding and careful testing.

Some flags are “pairs” of which one or the other must be true at all times.  Currently, `WIN32` (or its brethren) versus `NXSYSMac` is one such.  If, of course, there ever arises a Linux or other third platform, a stricter regime would be required.

Many of these flags represent developments, incidents, or test stages of the application; three are mandatory until they are extirpated.  The actual flags as specified to the compiler, in Visual Studio on Windows and Xcode on the Mac, are the authoritative source on what is necessary. The Mac `windows.h` spoof header defines the three “necessary“ ones on that platform.

### `_CRT_SECURE_NO_WARNINGS`

This is required on Windows if you don’t want to drown in compiler “warnings” about how `strlen`, `strcpy` and other old K&R C troupers are “dangerous”.  While (greater) NXSYS is becoming increasingly a “modern C++” app relying heavily on STL, `std::string` replacing the venerable `char *` and `char buf[MAX_PATH]` (let alone the new `std::filesystem` blessing), there are still numerous calls to these old chestnuts, and without this flag being specified, you will be scolded for each by the “modern” compiler.

Unfortunately, however, ***no*** Windows APIs accept STL strings, and many require `"LPCSTR"` (`const char *` in this non-UCS2 case) strings and a separate length, which is declared `int` in their headers.  This causes use of the results STL strings’ `size` method, which is `size_t`, which is unsigned, to provoke more warnings, so each such use now has to be cast with `(int)`.


### Significant, meaningful, current flags

Flag          |Meaning/remarks
--------------|---------------
NXSYSMac      |Means "we are compiling on/for the Mac", for all applications and utilities.
WINDOWS, WIN32, _WIN32|These ***all*** mean, "We are compiling on/for Windows.", whether 32 ***or 64 bits*** (Microsoft edict). All are required if so.
_WIN64        |64-bit Windows build. Required if so. Used in `About` dialog to proclaim same.
DEBUG, _DEBUG |Debug build. Both needed if so. Don’t do much in the applications, but many language & OS headers need them if debugging.
TLEDIT        |This is the track-layout editor, not the interlocking simulator.
REALLY_NXSYS  |This is the interlocking simulator, not the track-layout editor (inferred from TLEDIT on Mac).
_BLISP         |This is the Lisp test build, not either GUI app.

### Currently necessary, but obsolete, flags

These are set automatically by headers in the Mac build, but must be manually specified to the compiler on Windows. 

Flag          |Meaning
--------------|-------------------
PRODUCT_NAME  |This has to be ="NXSYS" or ="TLEdit". This is obsolescent. Quotes significant until then.
XTG, NXV2      |(Extended track geometry). Both signify NXSYS Version 2 (or TLEdit, which is only version 2).(3/20/22) It is thought that all Version 1 code has been extirpated, and that these are no longer necessary.
### Wholly obsolete flags still in the source
##### but are not ever to be specified.

I am removing such code (and declarations) as I catch them.

Flag          |Meaning
--------------|----------
RT, APPDEMO   |(“Rapid Transit”) Remains of a 1997 commercialization attempt.
NOTRAINS      |Used during testing train system to factor it out.
NXOGL         |(Open Graphics library).  Interface remains of the obsolete Version 1 Cab View system.
NXOLE         |Supporting the Windows OLE server and client program. Obsolete (no longer supported).
NXCMPOBJ      |(Supporting) compiled objects generated by the no-longer-supported (Windows) Relay Compiler.

All other flags that may appear (that I haven't thought of) are obsolete and may be assumed undefined/false ... I think.  There are some (e.g., `_RELAYS`) defined in the same module in which they are used (hence, not global).





